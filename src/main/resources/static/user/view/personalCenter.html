<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <link href="../../static/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
    <link href="../../static/plugins/layui/css/layui.css" rel="stylesheet" type="text/css"/>

    <title>3C数码-个人中心</title>
</head>
<body>
<style>
    .itemLi{
        width: 100px;
        height: 40px;
        float: left;
    }

</style>
<div style="background-color: #f0f0f0">
    <div class="container">

        <div id="topNav"></div>

        <div id="searchForm" class="input-group" style="margin: 5px 100px 45px 100px;">
            <span class="input-group-addon">3C数码</span>
            <input type="text" class="form-control">
            <span class="input-group-addon btn">搜索</span>
        </div>

        <hr style="border: #999 solid 1px; height: 0px"/>

        <div style="margin-bottom: 25px">
            <a href="index.html"><span style="color: grey" id="mouseChangeColor1">3CDigital</span></a>
            <span style="color: grey">></span>
            <a href="#"><span style="color: grey" id="mouseChangeColor2">我的3C</span></a>
        </div>

        <div class="layui-tab layui-tab-card">
            <ul class="layui-tab-title itemUl">
                <li class="layui-this itemLi" >个人中心</li>
                <li id="order" class="itemLi">我的订单</li>
                <li class="itemLi">修改密码</li>
            </ul>
            <div class="layui-tab-content itemDiv" style="height: auto;overflow: hidden">
                <div class="layui-tab-item layui-show">
                    <form class="layui-form">
                        <div class="layui-form-item">
                            <label class="layui-form-label">&nbsp;用户名</label>
                            <div class="layui-input-block">
                                 <span id="username" style="line-height: 36px"></span>
                            </div>
                        </div>

                        <div class="layui-form-item">
                            <label class="layui-form-label">邮箱</label>
                            <div class="layui-input-block">
                                <input id="email" type="text" name="title" lay-verify="title" autocomplete="off" placeholder="请输入邮箱" class="layui-input">
                            </div>
                        </div>

                        <div class="layui-form-item">
                            <label class="layui-form-label">手机号</label>
                            <div class="layui-input-block">
                                <input id="phone" type="text" name="title" lay-verify="title" autocomplete="off" placeholder="请输入手机号" class="layui-input">
                            </div>
                        </div>

                        <div class="layui-form-item">
                            <label class="layui-form-label">问题</label>
                            <div class="layui-input-block">
                                <input id="answer" type="text" name="title" lay-verify="title" autocomplete="off" placeholder="请输入问题" class="layui-input">
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label">答案</label>
                            <div class="layui-input-block">
                                <input id="question" type="text" name="title" lay-verify="title" autocomplete="off" placeholder="请输入答案" class="layui-input">
                            </div>
                        </div>
                    </form>
                    <button id="save" class="layui-btn">保存</button>
                </div>
                <div class="layui-tab-item">2</div>
                <div class="layui-tab-item">
                    <form class="layui-form">
                        <div class="layui-form-item">
                            <label class="layui-form-label">旧密码</label>
                            <div class="layui-input-block">
                                <input id="oldPassword" type="text" name="title" lay-verify="title" autocomplete="off" placeholder="请输入旧密码" class="layui-input">
                            </div>
                        </div>

                        <div class="layui-form-item">
                            <label class="layui-form-label">新密码</label>
                            <div class="layui-input-block">
                                <input id="newPassword" type="text" name="title" lay-verify="title" autocomplete="off" placeholder="请输入新密码" class="layui-input">
                            </div>
                        </div>

                        <div class="layui-form-item">
                            <label class="layui-form-label">确认&nbsp;密码</label>
                            <div class="layui-input-block">
                                <input id="newPassword2" type="text" name="title" lay-verify="title" autocomplete="off" placeholder="请再次输入密码" class="layui-input">
                            </div>
                        </div>
                    </form>
                    <button id="submitEdit" class="layui-btn">提交修改</button>
                </div>
            </div>
        </div>

        <div id="bottomNav"></div>
    </div>
</div>
<script src="../../static/plugins/jQuery/jquery-1.12.1.min.js" type="text/javascript"></script>
<script src="../../static/plugins/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
<script src="../../static/scripts/xingsu.user.topnav.js" type="text/javascript"></script>
<script src="../../static/scripts/xingsu.user.bottomNav.js" type="text/javascript"></script>
<script src="../../static/scripts/xingsu.ajax.auth.js" type="text/javascript"></script>
<script src="../../static/scripts/xingsu.config.js" type="text/javascript"></script>
<script src="../../static/scripts/xingsu.extensions.js" type="text/javascript"></script>
<script src="../../static/scripts/xingsu.util.js" type="text/javascript"></script>
<script src="../../static/plugins/layer/layer.js" type="text/javascript"></script>
<script type="text/javascript">
    $(function () {
        var urlObject = $utils.parseUrl(location.href);
        var type = urlObject.params["type"] || "null";

        var currentUser = JSON.parse(sessionStorage.getItem("currentUser"));
        init();

        $(".itemUl li").click(function () {
            var index = $(this).index();
           $(this).addClass("layui-this").siblings("li").removeClass("layui-this");
           $(this).parent(".itemUl").siblings(".itemDiv").find(".layui-tab-item").eq(index).addClass("layui-show").siblings("div").removeClass("layui-show");
        });

        if(type == "order"){
            $(".itemUl li").eq(1).trigger("click");
        }

        $("#username").text(currentUser.data.username);
        $("#email").val(currentUser.data.email);
        $("#phone").val(currentUser.data.phone);
        $("#answer").val(currentUser.data.answer);
        $("#question").val(currentUser.data.question);

        //更新用户信息
        $("#save").click(function () {
            var ajaxUrl = "../../user/update_information.do";
            var data = {
                "email": $("#email").val(),
                "phone": $("#phone").val(),
                "answer": $("#answer").val(),
                "question": $("#question").val()
            }
            $ajax.ajax(ajaxUrl, data, $config.HttpVerbs.POST, function (result) {
                if(!result.success){
                    layer.alert("更新用户信息失败！", {icon: 2});
                    console.log(result);
                    return;
                }
                layer.alert(result.msg, {icon: 1});
            });
        });

        //修改密码
        $("#submitEdit").click(function () {
            var oldPassword = $("#oldPassword").val();
            var newPassword = $("#newPassword").val();
            var newPassword2 = $("#newPassword2").val();
            if(newPassword != newPassword2){
                layer.alert("两次密码输入不一致，请检查后重新输入！", {icon: 5});
            }
            else if(oldPassword.length<6 || newPassword.length<6 || newPassword2.length<6){
                layer.alert("密码长度不能小于6", {icon: 5});

            }
            else{
                var ajaxUrl = "../../user/reset_password.do?passwordOld=" + oldPassword + "&passwordNew=" + newPassword;
                $ajax.ajax(ajaxUrl, null, $config.HttpVerbs.PUT, function (result) {
                    $("#oldPassword").val("");
                    $("#newPassword").val("");
                    $("#newPassword2").val("");
                   if(!result.success){
                       layer.alert(result.msg,{icon:2});
                   }else{
                       layer.alert(result.msg, {icon:1});
                   }
                });
            }
        });

        //todo 我的订单


        function init(){
            //鼠标移到的时候字显红色，移走恢复
            mouseChangeColor("mouseChangeColor1");
            mouseChangeColor("mouseChangeColor2");
        }

        //鼠标移动到指定元素改变颜色，鼠标指针从元素上移开再次恢复颜色
        function mouseChangeColor(id) {
            $("#"+ id).mouseover(function () {
                $("#"+ id).css("color", "red");
            });
            $("#" + id).mouseout(function(){
                $("#"+ id).css("color","grey");
            });
        }


    });

</script>
</body>
</html>